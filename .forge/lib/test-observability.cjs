LyoqCiAqIFRlc3RzIGZvciBPYnNlcnZhYmlsaXR5IExheWVyCiAqIEZvcmdl
IEZsb3cgNi40IC0gVDMuNAogKi8KCmNvbnN0IGZzID0gcmVxdWlyZSgnZnMn
KTsKY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsKY29uc3QgeyBMb2dn
ZXIsIExvZ0xldmVsLCBnZXRMb2dnZXIgfSA9IHJlcXVpcmUoJy4vbG9nZ2Vy
LmNqcycpOwpjb25zdCB7IE1ldHJpY3NSZWdpc3RyeSwgTWV0cmljVHlwZSwg
Z2V0TWV0cmljcyB9ID0gcmVxdWlyZSgnLi9tZXRyaWNzLmNqcycpOwoKLy8g
VGVzdCBsb2cgZGlyZWN0b3J5CmNvbnN0IFRFU1RfTE9HX0RJUiA9ICcuZm9y
Z2UvbG9nc190ZXN0JzsKCi8vIENsZWFudXAgaGVscGVyCmZ1bmN0aW9uIGNs
ZWFudXAoKSB7CiAgdHJ5IHsKICAgIGlmIChmcy5leGlzdHNTeW5jKFRFU1Rf
TE9HX0RJUikpIHsKICAgICAgZnMucm1TeW5jKFRFU1RfTE9HX0RJUiwgeyBy
ZWN1cnNpdmU6IHRydWUsIGZvcmNlOiB0cnVlIH0pOwogICAgfQogIH0gY2F0
Y2ggKGVycm9yKSB7CiAgICAvLyBJZ25vcmUKICB9Cn0KCi8vIFRlc3Qgc3Vp
dGUKKGFzeW5jICgpID0+IHsKICBjb25zb2xlLmxvZygn8J+nqiBUZXN0aW5n
IE9ic2VydmFiaWxpdHkgTGF5ZXIuLi5cbicpOwogIAogIGxldCBwYXNzZWQg
PSAwOwogIGxldCBmYWlsZWQgPSAwOwogIAogIC8vIENsZWFudXAgYmVmb3Jl
IHRlc3RzCiAgY2xlYW51cCgpOwogIAogIC8vIFRlc3QgMTogTG9nZ2VyIC0g
QmFzaWMgbG9nZ2luZwogIHRyeSB7CiAgICBjb25zdCBsb2dnZXIgPSBuZXcg
TG9nZ2VyKHsKICAgICAgbGV2ZWw6IExvZ0xldmVsLkRFQlVHLAogICAgICBl
bmFibGVDb25zb2xlOiBmYWxzZSwKICAgICAgZW5hYmxlRmlsZTogZmFsc2UK
ICAgIH0pOwogICAgCiAgICAvLyBTaG91bGQgbm90IHRocm93CiAgICBsb2dn
ZXIuZGVidWcoJ0RlYnVnIG1lc3NhZ2UnKTsKICAgIGxvZ2dlci5pbmZvKCdJ
bmZvIG1lc3NhZ2UnKTsKICAgIGxvZ2dlci53YXJuKCdXYXJuIG1lc3NhZ2Un
KTsKICAgIGxvZ2dlci5lcnJvcignRXJyb3IgbWVzc2FnZScpOwogICAgbG9n
Z2VyLmZhdGFsKCdGYXRhbCBtZXNzYWdlJyk7CiAgICAKICAgIGNvbnNvbGUu
bG9nKCfinIUgVGVzdCAxOiBMb2dnZXIgYmFzaWMgbG9nZ2luZycpOwogICAg
cGFzc2VkKys7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLmxvZygn
4p2MIFRlc3QgMTogTG9nZ2VyIGJhc2ljIGxvZ2dpbmcgLScsIGVyci5tZXNz
YWdlKTsKICAgIGZhaWxlZCsrOwogIH0KICAKICAvLyBUZXN0IDI6IExvZ2dl
ciAtIENvbnRleHQKICB0cnkgewogICAgY29uc3QgbG9nZ2VyID0gbmV3IExv
Z2dlcih7IGVuYWJsZUNvbnNvbGU6IGZhbHNlLCBlbmFibGVGaWxlOiBmYWxz
ZSB9KTsKICAgIAogICAgbG9nZ2VyLnNldENvbnRleHQoeyBzZXJ2aWNlOiAn
dGVzdCcsIHZlcnNpb246ICcxLjAnIH0pOwogICAgCiAgICAvLyBDcmVhdGUg
Y2hpbGQgd2l0aCBhZGRpdGlvbmFsIGNvbnRleHQKICAgIGNvbnN0IGNoaWxk
ID0gbG9nZ2VyLmNoaWxkKHsgcmVxdWVzdElkOiAnMTIzJyB9KTsKICAgIAog
ICAgaWYgKCFjaGlsZC5jb250ZXh0LnNlcnZpY2UpIHRocm93IG5ldyBFcnJv
cignTWlzc2luZyBwYXJlbnQgY29udGV4dCcpOwogICAgaWYgKCFjaGlsZC5j
b250ZXh0LnJlcXVlc3RJZCkgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIGNo
aWxkIGNvbnRleHQnKTsKICAgIAogICAgY29uc29sZS5sb2coJ+KchSBUZXN0
IDI6IExvZ2dlciBjb250ZXh0IGFuZCBjaGlsZCcpOwogICAgcGFzc2VkKys7
CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLmxvZygn4p2MIFRlc3Qg
MjogTG9nZ2VyIGNvbnRleHQgYW5kIGNoaWxkIC0nLCBlcnIubWVzc2FnZSk7
CiAgICBmYWlsZWQrKzsKICB9CiAgCiAgLy8gVGVzdCAzOiBMb2dnZXIgLSBD
b3JyZWxhdGlvbiBJRAogIHRyeSB7CiAgICBjb25zdCBsb2dnZXIgPSBuZXcg
TG9nZ2VyKHsgZW5hYmxlQ29uc29sZTogZmFsc2UsIGVuYWJsZUZpbGU6IGZh
bHNlIH0pOwogICAgCiAgICBsb2dnZXIuc2V0Q29ycmVsYXRpb25JZCgnY29y
ci0xMjMnKTsKICAgIAogICAgaWYgKGxvZ2dlci5jb3JyZWxhdGlvbklkICE9
PSAnY29yci0xMjMnKSB0aHJvdyBuZXcgRXJyb3IoJ0NvcnJlbGF0aW9uIElE
IG5vdCBzZXQnKTsKICAgIAogICAgbG9nZ2VyLmNsZWFyQ29ycmVsYXRpb25J
ZCgpOwogICAgCiAgICBpZiAobG9nZ2VyLmNvcnJlbGF0aW9uSWQgIT09IG51
bGwpIHRocm93IG5ldyBFcnJvcignQ29ycmVsYXRpb24gSUQgbm90IGNsZWFy
ZWQnKTsKICAgIAogICAgY29uc29sZS5sb2coJ+KchSBUZXN0IDM6IExvZ2dl
ciBjb3JyZWxhdGlvbiBJRCcpOwogICAgcGFzc2VkKys7CiAgfSBjYXRjaCAo
ZXJyKSB7CiAgICBjb25zb2xlLmxvZygn4p2MIFRlc3QgMzogTG9nZ2VyIGNv
cnJlbGF0aW9uIElEIC0nLCBlcnIubWVzc2FnZSk7CiAgICBmYWlsZWQrKzsK
ICB9CiAgCiAgLy8gVGVzdCA0OiBMb2dnZXIgLSBGaWxlIG91dHB1dAogIHRy
eSB7CiAgICBjb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKHsKICAgICAgbGV2
ZWw6IExvZ0xldmVsLklORk8sCiAgICAgIGVuYWJsZUNvbnNvbGU6IGZhbHNl
LAogICAgICBlbmFibGVGaWxlOiB0cnVlLAogICAgICBsb2dEaXI6IFRFU1Rf
TE9HX0RJUgogICAgfSk7CiAgICAKICAgIGxvZ2dlci5pbmZvKCdUZXN0IGxv
ZyBtZXNzYWdlJywgeyBmb286ICdiYXInIH0pOwogICAgCiAgICBjb25zdCBs
b2dGaWxlID0gcGF0aC5qb2luKFRFU1RfTE9HX0RJUiwgJ2ZvcmdlLWZsb3cu
bG9nJyk7CiAgICBpZiAoIWZzLmV4aXN0c1N5bmMobG9nRmlsZSkpIHRocm93
IG5ldyBFcnJvcignTG9nIGZpbGUgbm90IGNyZWF0ZWQnKTsKICAgIAogICAg
Y29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhsb2dGaWxlLCAndXRm
OCcpOwogICAgaWYgKCFjb250ZW50LmluY2x1ZGVzKCdUZXN0IGxvZyBtZXNz
YWdlJykpIHRocm93IG5ldyBFcnJvcignTG9nIG1lc3NhZ2Ugbm90IGZvdW5k
Jyk7CiAgICBpZiAoIWNvbnRlbnQuaW5jbHVkZXMoJ0lORk8nKSkgdGhyb3cg
bmV3IEVycm9yKCdMb2cgbGV2ZWwgbm90IGZvdW5kJyk7CiAgICAKICAgIGNv
bnNvbGUubG9nKCfinIUgVGVzdCA0OiBMb2dnZXIgZmlsZSBvdXRwdXQnKTsK
ICAgIHBhc3NlZCsrOwogIH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS5s
b2coJ+KdjCBUZXN0IDQ6IExvZ2dlciBmaWxlIG91dHB1dCAtJywgZXJyLm1l
c3NhZ2UpOwogICAgZmFpbGVkKys7CiAgfQogIAogIC8vIFRlc3QgNTogTWV0
cmljcyAtIENvdW50ZXIKICB0cnkgewogICAgY29uc3QgbWV0cmljcyA9IG5l
dyBNZXRyaWNzUmVnaXN0cnkoKTsKICAgIAogICAgbWV0cmljcy5pbmNyZW1l
bnQoJ3Rlc3RfY291bnRlcicpOwogICAgbWV0cmljcy5pbmNyZW1lbnQoJ3Rl
c3RfY291bnRlcicpOwogICAgbWV0cmljcy5pbmNyZW1lbnQoJ3Rlc3RfY291
bnRlcicsIHt9LCAzKTsKICAgIAogICAgY29uc3QgYWxsID0gbWV0cmljcy5n
ZXRBbGwoKTsKICAgIGlmIChhbGwudGVzdF9jb3VudGVyLnZhbHVlICE9PSA1
KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgNSwgZ290ICR7
YWxsLnRlc3RfY291bnRlci52YWx1ZX1gKTsKICAgIH0KICAgIAogICAgY29u
c29sZS5sb2coJ+KchSBUZXN0IDU6IE1ldHJpY3MgY291bnRlcicpOwogICAg
cGFzc2VkKys7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLmxvZygn
4p2MIFRlc3QgNTogTWV0cmljcyBjb3VudGVyIC0nLCBlcnIubWVzc2FnZSk7
CiAgICBmYWlsZWQrKzsKICB9CiAgCiAgLy8gVGVzdCA2OiBNZXRyaWNzIC0g
R2F1Z2UKICB0cnkgewogICAgY29uc3QgbWV0cmljcyA9IG5ldyBNZXRyaWNz
UmVnaXN0cnkoKTsKICAgIAogICAgbWV0cmljcy5zZXQoJ3Rlc3RfZ2F1Z2Un
LCB7fSwgNDIpOwogICAgbWV0cmljcy5zZXQoJ3Rlc3RfZ2F1Z2UnLCB7fSwg
MTAwKTsKICAgIAogICAgY29uc3QgYWxsID0gbWV0cmljcy5nZXRBbGwoKTsK
ICAgIGlmIChhbGwudGVzdF9nYXVnZS52YWx1ZSAhPT0gMTAwKSB7CiAgICAg
IHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgMTAwLCBnb3QgJHthbGwudGVz
dF9nYXVnZS52YWx1ZX1gKTsKICAgIH0KICAgIAogICAgY29uc29sZS5sb2co
J+KchSBUZXN0IDY6IE1ldHJpY3MgZ2F1Z2UnKTsKICAgIHBhc3NlZCsrOwog
IH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS5sb2coJ+KdjCBUZXN0IDY6
IE1ldHJpY3MgZ2F1Z2UgLScsIGVyci5tZXNzYWdlKTsKICAgIGZhaWxlZCsr
OwogIH0KICAKICAvLyBUZXN0IDc6IE1ldHJpY3MgLSBIaXN0b2dyYW0KICB0
cnkgewogICAgY29uc3QgbWV0cmljcyA9IG5ldyBNZXRyaWNzUmVnaXN0cnko
KTsKICAgIAogICAgbWV0cmljcy5yZWNvcmQoJ3Rlc3RfaGlzdG9ncmFtJywg
e30sIDEwKTsKICAgIG1ldHJpY3MucmVjb3JkKCd0ZXN0X2hpc3RvZ3JhbScs
IHt9LCAyMCk7CiAgICBtZXRyaWNzLnJlY29yZCgndGVzdF9oaXN0b2dyYW0n
LCB7fSwgMzApOwogICAgCiAgICBjb25zdCBhbGwgPSBtZXRyaWNzLmdldEFs
bCgpOwogICAgY29uc3Qgc3RhdHMgPSBhbGwudGVzdF9oaXN0b2dyYW0udmFs
dWU7CiAgICAKICAgIGlmIChzdGF0cy5jb3VudCAhPT0gMykgdGhyb3cgbmV3
IEVycm9yKCdXcm9uZyBjb3VudCcpOwogICAgaWYgKHN0YXRzLm1pbiAhPT0g
MTApIHRocm93IG5ldyBFcnJvcignV3JvbmcgbWluJyk7CiAgICBpZiAoc3Rh
dHMubWF4ICE9PSAzMCkgdGhyb3cgbmV3IEVycm9yKCdXcm9uZyBtYXgnKTsK
ICAgIGlmIChzdGF0cy5hdmcgIT09IDIwKSB0aHJvdyBuZXcgRXJyb3IoJ1dy
b25nIGF2ZycpOwogICAgCiAgICBjb25zb2xlLmxvZygn4pyFIFRlc3QgNzog
TWV0cmljcyBoaXN0b2dyYW0nKTsKICAgIHBhc3NlZCsrOwogIH0gY2F0Y2gg
KGVycikgewogICAgY29uc29sZS5sb2coJ+KdjCBUZXN0IDc6IE1ldHJpY3Mg
aGlzdG9ncmFtIC0nLCBlcnIubWVzc2FnZSk7CiAgICBmYWlsZWQrKzsKICB9
CiAgCiAgLy8gVGVzdCA4OiBNZXRyaWNzIC0gVGltZXIKICB0cnkgewogICAg
Y29uc3QgbWV0cmljcyA9IG5ldyBNZXRyaWNzUmVnaXN0cnkoKTsKICAgIAog
ICAgY29uc3QgdGltZXIgPSBtZXRyaWNzLnN0YXJ0VGltZXIoJ3Rlc3RfdGlt
ZXInKTsKICAgIAogICAgLy8gU2ltdWxhdGUgd29yawogICAgYXdhaXQgbmV3
IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwKSk7
CiAgICAKICAgIGNvbnN0IGR1cmF0aW9uID0gdGltZXIoKTsKICAgIAogICAg
aWYgKGR1cmF0aW9uIDwgMTApIHRocm93IG5ldyBFcnJvcignRHVyYXRpb24g
dG9vIHNob3J0Jyk7CiAgICAKICAgIGNvbnN0IGFsbCA9IG1ldHJpY3MuZ2V0
QWxsKCk7CiAgICBpZiAoYWxsLnRlc3RfdGltZXIudmFsdWUuY291bnQgIT09
IDEpIHRocm93IG5ldyBFcnJvcignVGltZXIgbm90IHJlY29yZGVkJyk7CiAg
ICAKICAgIGNvbnNvbGUubG9nKCfinIUgVGVzdCA4OiBNZXRyaWNzIHRpbWVy
Jyk7CiAgICBwYXNzZWQrKzsKICB9IGNhdGNoIChlcnIpIHsKICAgIGNvbnNv
bGUubG9nKCfinYwgVGVzdCA4OiBNZXRyaWNzIHRpbWVyIC0nLCBlcnIubWVz
c2FnZSk7CiAgICBmYWlsZWQrKzsKICB9CiAgCiAgLy8gVGVzdCA5OiBNZXRy
aWNzIC0gTGFiZWxzCiAgdHJ5IHsKICAgIGNvbnN0IG1ldHJpY3MgPSBuZXcg
TWV0cmljc1JlZ2lzdHJ5KCk7CiAgICAKICAgIG1ldHJpY3MuaW5jcmVtZW50
KCd0ZXN0X2xhYmVsZWQnLCB7IHN0YXR1czogJ3N1Y2Nlc3MnIH0pOwogICAg
bWV0cmljcy5pbmNyZW1lbnQoJ3Rlc3RfbGFiZWxlZCcsIHsgc3RhdHVzOiAn
ZmFpbHVyZScgfSk7CiAgICBtZXRyaWNzLmluY3JlbWVudCgndGVzdF9sYWJl
bGVkJywgeyBzdGF0dXM6ICdzdWNjZXNzJyB9KTsKICAgIAogICAgY29uc3Qg
YWxsID0gbWV0cmljcy5nZXRBbGwoKTsKICAgIAogICAgaWYgKCFhbGwudGVz
dF9sYWJlbGVkLmxhYmVscykgdGhyb3cgbmV3IEVycm9yKCdMYWJlbHMgbm90
IGZvdW5kJyk7CiAgICAKICAgIGNvbnN0IHN1Y2Nlc3NMYWJlbCA9IE9iamVj
dC52YWx1ZXMoYWxsLnRlc3RfbGFiZWxlZC5sYWJlbHMpLmZpbmQoCiAgICAg
IGwgPT4gbC5sYWJlbHMuc3RhdHVzID09PSAnc3VjY2VzcycKICAgICk7CiAg
ICBjb25zdCBmYWlsdXJlTGFiZWwgPSBPYmplY3QudmFsdWVzKGFsbC50ZXN0
X2xhYmVsZWQubGFiZWxzKS5maW5kKAogICAgICBsID0+IGwubGFiZWxzLnN0
YXR1cyA9PT0gJ2ZhaWx1cmUnCiAgICApOwogICAgCiAgICBpZiAoc3VjY2Vz
c0xhYmVsLnZhbHVlICE9PSAyKSB0aHJvdyBuZXcgRXJyb3IoJ1dyb25nIHN1
Y2Nlc3MgY291bnQnKTsKICAgIGlmIChmYWlsdXJlTGFiZWwudmFsdWUgIT09
IDEpIHRocm93IG5ldyBFcnJvcignV3JvbmcgZmFpbHVyZSBjb3VudCcpOwog
ICAgCiAgICBjb25zb2xlLmxvZygn4pyFIFRlc3QgOTogTWV0cmljcyB3aXRo
IGxhYmVscycpOwogICAgcGFzc2VkKys7CiAgfSBjYXRjaCAoZXJyKSB7CiAg
ICBjb25zb2xlLmxvZygn4p2MIFRlc3QgOTogTWV0cmljcyB3aXRoIGxhYmVs
cyAtJywgZXJyLm1lc3NhZ2UpOwogICAgZmFpbGVkKys7CiAgfQogIAogIC8v
IFRlc3QgMTA6IFByb21ldGhldXMgZXhwb3J0CiAgdHJ5IHsKICAgIGNvbnN0
IG1ldHJpY3MgPSBuZXcgTWV0cmljc1JlZ2lzdHJ5KCk7CiAgICAKICAgIG1l
dHJpY3MuaW5jcmVtZW50KCdodHRwX3JlcXVlc3RzX3RvdGFsJywgeyBtZXRo
b2Q6ICdHRVQnIH0sIDUpOwogICAgbWV0cmljcy5yZWNvcmQoJ2h0dHBfZHVy
YXRpb25fbXMnLCB7IG1ldGhvZDogJ0dFVCcgfSwgMTAwKTsKICAgIAogICAg
Y29uc3QgcHJvbWV0aGV1cyA9IG1ldHJpY3MuZXhwb3J0UHJvbWV0aGV1cygp
OwogICAgCiAgICBpZiAoIXByb21ldGhldXMuaW5jbHVkZXMoJ2h0dHBfcmVx
dWVzdHNfdG90YWwnKSkgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIGNvdW50
ZXInKTsKICAgIGlmICghcHJvbWV0aGV1cy5pbmNsdWRlcygnaHR0cF9kdXJh
dGlvbl9tcycpKSB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgaGlzdG9ncmFt
Jyk7CiAgICBpZiAoIXByb21ldGhldXMuaW5jbHVkZXMoJyMgSEVMUCcpKSB0
aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgaGVscCB0ZXh0Jyk7CiAgICBpZiAo
IXByb21ldGhldXMuaW5jbHVkZXMoJyMgVFlQRScpKSB0aHJvdyBuZXcgRXJy
b3IoJ01pc3NpbmcgdHlwZSB0ZXh0Jyk7CiAgICAKICAgIGNvbnNvbGUubG9n
KCfinIUgVGVzdCAxMDogUHJvbWV0aGV1cyBleHBvcnQnKTsKICAgIHBhc3Nl
ZCsrOwogIH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS5sb2coJ+KdjCBU
ZXN0IDEwOiBQcm9tZXRoZXVzIGV4cG9ydCAtJywgZXJyLm1lc3NhZ2UpOwog
ICAgZmFpbGVkKys7CiAgfQogIAogIC8vIENsZWFudXAgYWZ0ZXIgdGVzdHMK
ICBjbGVhbnVwKCk7CiAgCiAgLy8gU3VtbWFyeQogIGNvbnNvbGUubG9nKGBc
biR7Jz0nLnJlcGVhdCg1MCl9YCk7CiAgY29uc29sZS5sb2coYOKchSBQYXNz
ZWQ6ICR7cGFzc2VkfS8xMGApOwogIGNvbnNvbGUubG9nKGDinYwgRmFpbGVk
OiAke2ZhaWxlZH0vMTBgKTsKICBjb25zb2xlLmxvZyhgJHsnPScucmVwZWF0
KDUwKX1gKTsKICAKICBpZiAoZmFpbGVkID4gMCkgewogICAgcHJvY2Vzcy5l
eGl0KDEpOwogIH0KICAKfSkoKTsK